var titleTag=document.head.querySelector("title");onSearchListeners.push(function(e,r){if(!r){addSearchHistoryFrame(e);if(ga){ga("send","pageview","/?search="+e)}}});rawSearch=function(e){var r=searchBar.value;var t=getTermsFromSearchString(r);console.log("searching",t);var a=[];searchData.forEach(function(e){if(allTermsMatchMaerke(e,t)){a.push(e)}});console.log("Got "+a.length+" matches for search");onSearchListeners.forEach(function(t){t(r,e)});titleTag.innerHTML="Søg: "+r+" | Mærkelex";renderMatches(a)};function getTermsFromSearchString(e){return e.replace(/\s+/," ").split(" ")}function allTermsMatchMaerke(e,r){return r.every(function(r){return matchesMaerke(e,r)})}function matchesMaerke(e,r){if(r.indexOf("tag:")==0){var t=r.substring(4);return e.tags.some(function(e){return e.match(new RegExp("^"+t+"$","i"))})}if(r.indexOf("alder:")==0){var a=parseInt(r.substring(6));if(isNaN(a)){console.warn("User input in 'alder' invalid (should be number, is NaN)",r);return false}if(e.age=="*"){return true}if(e.age.indexOf("+")==e.age.length-1){return a>=e.age.slice(0,-1)}if(e.age.indexOf("-")==-1){return a==e.age}var n=e.age.split("-");return a>=n[0]&&a<=n[1]}var s=new RegExp(r,"i");if(e.name.replace(/&.+;/,"").match(s)){return true}for(var i=0;i<e.tags.length;i++){var o=e.tags[i];if(o.match(s)){return true}}return false}function addSearchHistoryFrame(e){history.pushState({search:e,maerkelex:true},"Mærkelex","/?search="+e)}function renderMatches(e){var r=document.querySelector(".container .content");if(e.length<1){var t='<div class="no-search-matches">Ingen mærker matchede din søgning på <strong>'+searchBar.value+"</strong>."+"<br><br>"+'Mangler vi et mærke? <a href="mailto:kontakt@maerkelex.dk">Skriv os en email</a>, så retter vi det hurtigst muligt!</div>';r.innerHTML=t;return}r.innerHTML=renderResults(e)}function renderResults(e){return e.map(function(e){var r=e.age;if(r=="*"){r="Alle aldre"}else{r=e.age+" år"}return'<div class="maerke-col">  <div class="maerke-box">    <a class="maerke-link" href="'+e.url+'">      <div class="maerke-info">        <div class="maerke-corps '+e.tags[0]+'">          '+e.tags[0]+'        </div>        <div class="maerke-age">          '+r+'        </div>      </div>      <img src="/img/'+e.image+'" />      <div class="card-content">        <h3>'+e.name+'</h3>      </div>    </a>    <a href="'+e.url+'">    <div class="card-link">      Læs Mere    </div>    </a>  </div></div>'}).join("")}(function e(r){if(!r){r=3}var t=new XMLHttpRequest;t.open("GET","/m.summary.json");t.onreadystatechange=function(){if(t.readyState!=4){return}if(t.status>499&&t.status<600){console.warn("Server error happened while getting searchable data (status "+t.status+"): "+t.responseText);if(r>0){console.warn("Retrying getting of search data in 500 ms ...");return setTimeout(function(){e(r-1)},500)}}if(t.status!=200){return console.error("Failed to get searchable data (status "+t.status+"): "+t.responseText)}var a;try{a=JSON.parse(t.responseText)}catch(n){return console.warn("Received unparseable data",t.responseText)}searchData=a.m};t.send()})();var tags=document.querySelectorAll("a.tag");Array.prototype.forEach.call(tags,function(e){e.addEventListener("click",function(r){r.preventDefault();searchBar.value="tag:"+e.innerHTML;searchBar.focus();search();return true})});(function r(){if(!userHasVisitedBefore()){showCookieNotice();showWelcomeMessage();setUserHasVisitedBefore()}})();function userHasVisitedBefore(){var e=document.cookie.split(";");if(e.length<1){return false}e=e.filter(function(e){return e.trim().match(/^maerkelexCookieNoticeShown=/)});var r=e[0];return!!r}function showCookieNotice(){var e=elementFromHtml('<div class="cookieNotice">Vi bruger cookies for at forbedre bruger&#173;oplevelsen. Ved at bruge siden giver du dit samtykke til at vi samler anonym information om hvilke sider der besøges mest på siden.</div>');document.body.appendChild(e);e.addEventListener("click",function(e){this.className+=" hidden"})}function elementFromHtml(e){var r=document.createElement("div");r.innerHTML=e;return r.firstChild}function showWelcomeMessage(){var e=elementFromHtml('<div class="first-visit-welcome"><div class="first-visit-welcome-remover">Fjern besked</div><div class="first-visit-welcome-image"></div><div class="first-visit-welcome-text"><p>Velkommen til Mærkelex!</p><p>Vi prøver at samle alle forløbs- og dueligheds&#173;mærker fra danske spejder&#173;korps, inklusiv de hjemme&#173;lavede, som folk selv laver og sælger.</p><p>Hvis du finder ud af at vi mangler et mærke, eller der står noget på siden der er forkert, kan du <a href="mailto:kontakt@mærkelex.dk">sende os en email</a>.</p></div></div>');var r=document.querySelector(".container");r.insertBefore(e,r.firstChild);document.querySelector(".first-visit-welcome-remover").addEventListener("click",function(r){e.className+=" hidden"});onSearchListeners.push(function(){e.className+=" hidden"})}function setUserHasVisitedBefore(){document.cookie="maerkelexCookieNoticeShown=1;expires="+new Date(Date.now()+1e3*60*60*24*30).toUTCString()+";path=/"}